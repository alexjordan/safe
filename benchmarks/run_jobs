#!/bin/bash
#
# Executes the collection of jobs in JOBS and logs the results into the RESULTS
# folder.

IN_PATH=.
JOBS=$IN_PATH/jobs_list
TMP=$IN_PATH/tmp
RESULTS=$IN_PATH/results

mkdir -p $RESULTS

while
  # If $JOBS exists and has a positive size.
  [ -s $JOBS  ]
do
  job=`head -n 1 $JOBS`
  cat $JOBS | sed '1d' > $TMP
  cp $TMP $JOBS

  name=`echo $job | awk -F\| '{print $1}'`
   dom=`echo $job | awk -F\| '{print $2}'`
  size=`echo $job | awk -F\| '{print $3}'`
  echo "Processing $name $dom $size ..."
  bash analyze_strdom_param.sh $name $dom $size
  echo "Done!"

  echo "Sleeping 10 seconds..."
  sleep 10

done

rm -f $TMP
mv $IN_PATH/*.txt $RESULTS
